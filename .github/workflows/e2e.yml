name: e2e

on:
    workflow_dispatch: {}

jobs:
    e2e-github:
        runs-on: ubuntu-latest
        env:
            RUN_E2E: '1'
            CRED_KEYSTORE: memory
            CRED_MASTER_KEY_B64: ${{ secrets.CRED_MASTER_KEY_B64 }}
            GITHUB_PAT: ${{ secrets.CRED_E2E_GITHUB_PAT }}
            E2E_GITHUB_REPO: ${{ vars.E2E_GITHUB_REPO || github.repository }}
        steps:
            - uses: actions/checkout@v4

            - uses: dtolnay/rust-toolchain@stable

            - name: Run e2e GitHub secrets test
              run: cargo test --test e2e_github -- --nocapture
